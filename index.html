<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640" />

    <link rel="stylesheet" href="stylesheets/core.css" media="screen"/>
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)"/>
    <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>Yamop for Laravel 4 by mawelous</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/mawelous/yamop-laravel">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>Yamop for Laravel 4</h1>
            <h2>Yet another MongoDB ODM for PHP as Laravel Component</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/mawelous/yamop-laravel/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/mawelous/yamop-laravel/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <ul>
<li><a href="#whatsthat">What's that?</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#pagination">Pagination</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#Issues">Issues</a></li>
<li><a href="#license">License</a></li>
</ul><p><a name="whatsthat"></a></p>

<h2>
<a name="whats-that" class="anchor" href="#whats-that"><span class="octicon octicon-link"></span></a>What's that?</h2>

<p>This is yet another, open source, and very simple <a href="http://www.mongodb.org/">MongoDB</a> ODM for <a href="http://www.laravel.com/">Laravel 4</a>.
It works like the standard MongoDB PHP extension interface but returns objects instead of arrays (as ODM). Queries stay the same.
One of its coolest features are joins which allow you to query for related objects.
This version for Laravel is based on <a href="https://github.com/mawelous/yamop">Yamop</a> which can be included into any PHP project. In addition to the standard features it supports Laravel based authentication.</p>

<p><a name="requirements"></a></p>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>PHP 5.3+</li>
<li>PHP MongoDB Extension</li>
<li>Laravel 4</li>
</ul><p><a name="installation"></a></p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>You can simply download it <a href="https://github.com/mawelous/yamop-laravel">here</a> or use <a href="http://getcomposer.org/">Composer</a>.</p>

<p>In the <code>require</code> key inside the <code>composer.json</code> file add the following</p>

<div class="highlight"><pre>    <span class="s">"mawelous/yamop-laravel"</span><span class="p-Indicator">:</span> <span class="s">"dev-master"</span>
</pre></div>

<p>Save it and run the Composer update command</p>

<pre><code>$ composer update
</code></pre>

<p>After this is done, add <code>mongo</code> in your database configuration:</p>

<div class="highlight"><pre>    <span class="s1">'mongo'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'host'</span>     <span class="o">=&gt;</span> <span class="s1">'host'</span><span class="p">,</span>
        <span class="s1">'port'</span>     <span class="o">=&gt;</span> <span class="mi">37847</span><span class="p">,</span>
        <span class="s1">'database'</span> <span class="o">=&gt;</span> <span class="s1">'db'</span><span class="p">,</span>
        <span class="s1">'user'</span>     <span class="o">=&gt;</span> <span class="s1">'user'</span><span class="p">,</span>
        <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'pass'</span>
    <span class="p">),</span>
</pre></div>

<p>Now we need to let Laravel know about this new service provider. To do so add under <code>providers</code> in the <code>config\app.php</code> file the following:</p>

<div class="highlight"><pre>    <span class="o">...</span>
    <span class="s1">'Illuminate\View\ViewServiceProvider'</span><span class="p">,</span>
    <span class="s1">'Illuminate\Workbench\WorkbenchServiceProvider'</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="s1">'Mawelous\YamopLaravel\YamopLaravelServiceProvider'</span><span class="p">,</span>
</pre></div>

<p>Aliases to the Yamop classes are useful. Add them in the <code>aliases</code> array in the <code>config\app.php</code> file:</p>

<div class="highlight"><pre>    <span class="o">...</span>
    <span class="s1">'Validator'</span>       <span class="o">=&gt;</span> <span class="s1">'Illuminate\Support\Facades\Validator'</span><span class="p">,</span>
    <span class="s1">'View'</span>            <span class="o">=&gt;</span> <span class="s1">'Illuminate\Support\Facades\View'</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="s1">'Mapper'</span>          <span class="o">=&gt;</span> <span class="s1">'Mawelous\YamopLaravel\Mapper'</span><span class="p">,</span>
    <span class="s1">'Model'</span>           <span class="o">=&gt;</span> <span class="s1">'Mawelous\YamopLaravel\Model'</span><span class="p">,</span>
</pre></div>

<p>To use Yamop you now just need to extend the Yamop alias <code>Model</code> from within any of your new or existing models:</p>

<div class="highlight"><pre>    <span class="k">class</span> <span class="nc">Article</span> <span class="k">extends</span> <span class="nx">Model</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">static</span> <span class="nv">$_collectionName</span> <span class="o">=</span> <span class="s1">'articles'</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>

<p>That's it!</p>

<p><a name="usage"></a></p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>For usage examples and further explanation take a look at the <a href="https://github.com/mawelous/yamop#usage">Yamop Documentation</a>. In this release for Laravel you can also use aliases for <code>Mapper</code> and <code>Model</code> which were registered during installation. See the following pagination example.</p>

<p><a name="pagination"></a></p>

<h2>
<a name="pagination" class="anchor" href="#pagination"><span class="octicon octicon-link"></span></a>Pagination</h2>

<p>Yamop for Laravel supports pagination out of the box. Yamop implements the <code>_createPaginator</code> method and extends <code>getPaginator</code>, with this you only need to pass the items per page into the method. The second parameter, the current page number, is optional.</p>

<div class="highlight"><pre>    <span class="nx">User</span><span class="o">::</span><span class="na">getMapper</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span> <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s1">'$ne'</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">STATUS_DELETED</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">sort</span><span class="p">(</span> <span class="p">[</span> <span class="nv">$field</span> <span class="o">=&gt;</span> <span class="nv">$direction</span> <span class="p">]</span> <span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">getPaginator</span><span class="p">(</span> <span class="nv">$perPage</span> <span class="p">);</span>

    <span class="c1">//or</span>
    <span class="nx">User</span><span class="o">::</span><span class="na">getMapper</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">getPaginator</span><span class="p">(</span> <span class="nv">$perPage</span><span class="p">,</span> <span class="nv">$currentPage</span> <span class="p">);</span>
</pre></div>

<p><a name="authentication"></a></p>

<h2>
<a name="authentication" class="anchor" href="#authentication"><span class="octicon octicon-link"></span></a>Authentication</h2>

<p>Laravel's package of Yamop supports native like authentication.
You must first extend your <code>User</code> Model with Yamop's <code>Mawelous\YampoLaravel\User</code></p>

<div class="highlight"><pre>    <span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Mawelous\YamopLaravel\User</span>
    <span class="p">{</span>
        <span class="k">protected</span> <span class="k">static</span> <span class="nv">$_collectionName</span> <span class="o">=</span> <span class="s1">'users'</span><span class="p">;</span>    
    <span class="p">}</span>
</pre></div>

<p>In <code>auth\config.php</code> change the driver to <code>yamop</code>.</p>

<div class="highlight"><pre>    <span class="o">...</span>
    <span class="s1">'driver'</span> <span class="o">=&gt;</span> <span class="s1">'yamop'</span><span class="p">,</span>
    <span class="o">...</span>
</pre></div>

<p>Now you can implement it as standard authentication:</p>

<div class="highlight"><pre>    <span class="k">class</span> <span class="nc">AuthController</span> <span class="k">extends</span> <span class="nx">BaseController</span> <span class="p">{</span>

        <span class="k">public</span> <span class="k">function</span> <span class="nf">getLogin</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nx">View</span><span class="o">::</span><span class="na">make</span><span class="p">(</span> <span class="s1">'auth.login'</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">function</span> <span class="nf">postLogin</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">attempt</span><span class="p">(</span> <span class="p">[</span> <span class="s1">'nickname'</span> <span class="o">=&gt;</span> <span class="nx">Input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span> <span class="s1">'nickname'</span> <span class="p">),</span> <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="nx">input</span><span class="o">::</span><span class="na">get</span><span class="p">(</span> <span class="s1">'password'</span> <span class="p">)</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">intended</span><span class="p">(</span> <span class="s1">'dashboard'</span> <span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">to</span><span class="p">(</span> <span class="s1">'/login'</span> <span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span> <span class="s1">'login_failed'</span><span class="p">,</span> <span class="k">true</span> <span class="p">);</span>
            <span class="p">}</span>       
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>

<p><a name="issues"></a></p>

<h2>
<a name="issues" class="anchor" href="#issues"><span class="octicon octicon-link"></span></a>Issues</h2>

<p>Any issues or questions please <a href="https://github.com/Mawelous/yamop-laravel/issues">report here</a></p>

<p><a name="license"></a></p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>Yamop is free software distributed under the terms of the <a href="http://opensource.org/licenses/MIT">MIT license</a></p>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/mawelous">mawelous</a> can be found on <a href="https://github.com/mawelous/yamop-laravel">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="http://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  </body>
</html>
